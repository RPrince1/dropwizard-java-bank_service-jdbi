/*
 * This build file was auto generated by running the Gradle 'init' task
 * by 'sysdevjm' at '26/07/16 13:26' with Gradle 2.1
 *
 * This generated file contains a sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * user guide available at http://gradle.org/docs/2.1/userguide/tutorial_java_projects.html
 */

// Apply the java plugin to add support for Java
apply plugin: 'java'
apply plugin: 'idea'
apply plugin: 'gradle-one-jar'

allprojects {
    tasks.withType(JavaCompile) {
        sourceCompatibility = '1.8'
        targetCompatibility = '1.8'
    }
}

task jarIt(type: OneJar) {
    mainClass = 'com.morrisons.base.dropwizard.BaseDWApplication'
}
 
task wrapper(type: Wrapper) {
    gradleVersion = '4.5.1'
}

configurations {
    cucumberRuntime {
        extendsFrom testRuntime
    }
}

task cucumber() {
    dependsOn assemble, compileTestJava
    doLast {
        javaexec {
            main = 'cucumber.api.cli.Main'
            classpath = configurations.cucumberRuntime + sourceSets.main.output + sourceSets.test.output
            if (project.hasProperty('ciBuild')) {
                systemProperties  ciBuild: 'ciBuild'
            }
            args = ['-f', 'usage', '--glue', 'steps', 'src/test/resources', '--tags', '~@wip', '--format', 'html:build/reports', '--format', 'json:build/reports/report.json']
        }
    }
}

// In this section you declare where to find the dependencies of your project
repositories {
//    maven {
//        url 'http://nexus.ci.morconnect.com/repository/morrisons/'
//    }
    mavenLocal()
    flatDir {
        dirs 'lib'
    }
    jcenter()
    mavenCentral()
}

// In this section you declare the dependencies for your production and test code
dependencies {

  compile ('io.swagger:swagger-jersey2-jaxrs:1.5.16') {
       exclude group: 'org.glassfish.jersey.core', module: 'jersey-common'
       exclude group: 'org.glassfish.jersey.core', module: 'jersey-server'
       exclude group: 'org.glassfish.jersey.core', module: 'jersey-client'
       exclude group: 'org.glassfish.jersey.containers', module: 'jersey-container-servlet-core'
   }
   compile ('io.swagger:swagger-jaxrs:1.5.16') {
       exclude group: 'javax.ws.rs', module: 'jsr311-api'
   }
   compile ('io.swagger:swagger-annotations:1.5.16') {
       exclude group: 'io.swagger', module: 'swagger-parser'
   }

   compile(
            'org.slf4j:slf4j-api:1.7.25',
            'io.dropwizard:dropwizard-core:1.1.2',
            'io.dropwizard:dropwizard-forms:1.1.2',
            'io.dropwizard:dropwizard-assets:1.1.2',
            'io.dropwizard:dropwizard-jdbi:1.1.2',
            'io.dropwizard:dropwizard-client:1.1.2',


            'de.thomaskrille:dropwizard-template-config:1.5.0',
            'ru.vyarus:dropwizard-guicey:4.1.0',
            'org.projectlombok:lombok:1.16.18',

            'org.json:json:20170516',
            'commons-beanutils:commons-beanutils:1.9.3',
            'commons-io:commons-io:2.5',
            'commons-beanutils:commons-beanutils:1.9.2',

            'postgresql:postgresql:9.4.1208-jdbc42-atlassian-hosted',
            'ru.vyarus.guicey:guicey-jdbi:0.2.1',
            'org.antlr:stringtemplate:3.2',
            'org.flywaydb:flyway-core:5.0.3',

            'com.diffplug.durian:durian:3.4.0'
    )

    compile fileTree( dir: 'lib')

    testCompile(
          'io.dropwizard:dropwizard-testing:1.1.2',
          'junit:junit:4.12',
          'org.mockito:mockito-core:2.8.47',
          'com.jayway.jsonpath:json-path-assert:2.2.0',
          'org.skyscreamer:jsonassert:1.4.0',
          'org.hamcrest:hamcrest-all:1.3',
          'org.easytesting:fest-assert:1.4',
          'org.mock-server:mockserver-netty:3.12',
          'info.cukes:cucumber-java8:1.2.5',
          'info.cukes:cucumber-picocontainer:1.2.5',
          'info.cukes:cucumber-junit:1.2.5',
          'com.opentable.components:otj-pg-embedded:0.11.0'
    )
}

buildscript {
    repositories {
//        maven {
//            url 'http://nexus.ci.morconnect.com/repository/morrisons/'
//        }
        mavenLocal()
        flatDir {
            dirs 'lib'
        }
        maven {
            url 'https://plugins.gradle.org/m2/'
        }
        maven {
            url 'http://repo.spring.io/plugins-release'
        }
        jcenter()
        mavenCentral()
    }

    dependencies {
        classpath ':annotations-2.0.1'
        classpath 'gradle.plugin.com.github.onslip:gradle-one-jar:1.0.5'
        classpath 'com.benjaminsproule:swagger-gradle-plugin:0.1.0' //swagger.json generation
        classpath 'io.github.swagger2markup:swagger2markup:1.3.1'   //markup from swagger generation
    }
}
